<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zbkj.service.dao.StoreOrderInfoDao">

    <select id="getSalesNumByDateAndProductId" resultType="java.lang.Integer">
        select IFNULL(sum(pay_num), 0) as pay_num from eb_store_order_info
        where mer_order_no in (SELECT id FROM `eb_store_order` where paid = 1 and date_format(create_time, '%Y-%m-%d') = #{date})
        and product_id = #{proId}
    </select>

    <select id="getSalesByDateAndProductId" resultType="java.math.BigDecimal">
        select IFNULL(sum(price), 0) as price from eb_store_order_info
        where mer_order_no in (SELECT id FROM `eb_store_order` where paid = 1 and date_format(create_time, '%Y-%m-%d') = #{date})
        and product_id = #{proId}
    </select>

    <select id="findReplyList" resultType="com.zbkj.common.model.order.StoreOrderInfo">
        select soi.* from eb_store_order_info soi
        left join eb_store_order so on so.order_no = soi.mer_order_no and so.status = 3 and so.is_user_del = 0
        where
        soi.is_reply = 0 and soi.is_receipt = 1
        and so.uid = #{userId}
        order by soi.id desc
    </select>

    <select id="getAwaitNumByUid" resultType="java.lang.Integer">
        select count(*) from eb_store_order_info soi
        left join eb_store_order so on so.order_no = soi.mer_order_no and so.status = 3 and so.is_user_del = 0
        where
        soi.is_reply = 0 and soi.is_receipt = 1
        and so.uid = #{userId}
    </select>

</mapper>
